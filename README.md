# 123网盘开放平台工具集

这是一套用于操作123网盘开放平台API的Python工具集，包含文件查询、上传、下载、离线下载、直链管理和图床服务等功能。

## ✨ 功能特点

- 🔐 **安全设计** - 所有凭据通过配置文件管理，代码无硬编码敏感信息
- 🚀 **智能上传** - 自动选择单步或分片上传，支持秒传和断点续传
- 📊 **进度显示** - 实时显示上传下载进度，操作状态清晰可见
- ✅ **完整校验** - 自动MD5校验，确保文件完整性
- 🛠️ **命令行友好** - 支持参数模式和交互模式，使用灵活
- 📚 **文档完善** - 每个功能都有详细API文档和代码示例

## 📦 功能模块

- **查询文件** (`查询文件/查询文件.py`) - 查询和搜索云盘文件，支持模糊/精准搜索
- **上传文件** (`上传文件/upload_to_123pan_v2.py`) - 支持单步和分片上传，自动秒传检测
- **下载文件** (`下载文件/下载文件.py`) - 下载云盘文件到本地，支持MD5校验
- **离线下载** (`离线下载/simple_offline_download.py`) - 创建离线下载任务，支持批量导入
- **直链管理** (`直链/direct_link.py`) - 文件直链管理、流量监控和IP黑名单配置
- **图床服务** (`图床/image_hosting.py`) - 图片上传、管理和CDN加速分发
- **Markdown转换** (`Markdown的互相转换/`) - Markdown文件与123网盘互转工具集

## ⚙️ 配置说明

### 快速开始

#### 1. 获取API凭据

访问 [123云盘开放平台](https://open.123pan.com/)：
1. 注册并登录开发者账号
2. 创建应用
3. 获取 `CLIENT_ID` 和 `CLIENT_SECRET`

#### 2. 配置文件

在项目根目录编辑 `config.txt`：

```ini
# 123网盘开放平台配置文件

# API认证凭据（必填）
CLIENT_ID=your_client_id_here
CLIENT_SECRET=your_client_secret_here

# 上传文件配置（可选）
PARENT_FILE_ID=0                    # 默认上传目录ID，0表示根目录
```

#### 3. 安装依赖

```bash
pip install requests
```

#### 4. 开始使用

```bash
# 查询文件
cd 查询文件
python 查询文件.py

# 上传文件
cd 上传文件
python upload_to_123pan_v2.py your_file.zip

# 下载文件
cd 下载文件
python 下载文件.py --file-id 12345
```

## 🔐 安全提醒

### ⚠️ 极其重要的安全注意事项

1. **绝对不要将 `config.txt` 提交到版本控制系统**（Git、SVN等）
2. **不要将 `config.txt` 上传到公开仓库**（如GitHub、Gitee等）
3. **定期更换API凭据**，特别是在怀疑泄露时
4. **立即删除编辑器历史备份**（如 `.history/` 目录）

### .gitignore 配置

确保项目根目录有 `.gitignore` 文件，内容至少包含：

```gitignore
# 敏感配置文件
config.txt
*.conf
.env
.env.*

# 编辑器历史备份
.history/
.vscode/
.idea/

# Python缓存
__pycache__/
*.pyc
*.pyo
*.pyd

# 日志文件
*.log
```

### 凭据泄露应对

如果不慎泄露了 `CLIENT_ID` 和 `CLIENT_SECRET`：

1. **立即**前往 [123云盘开放平台](https://open.123pan.com/) 重新生成新凭据
2. 更新本地 `config.txt`
3. 如果已提交到Git，使用以下方法清除历史记录：

```bash
# 方法1：删除文件并清除历史（推荐使用BFG）
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch config.txt" \
  --prune-empty --tag-name-filter cat -- --all

# 方法2：使用BFG Repo-Cleaner（更快更安全）
bfg --delete-files config.txt
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 强制推送到远程仓库
git push origin --force --all
```

## 📖 使用方法

### 1️⃣ 查询文件

**功能**：列出云盘文件、搜索文件、获取文件详情

```bash
cd 查询文件
python 查询文件.py
```

**支持的操作**：
- 获取文件列表（支持翻页）
- 模糊/精准搜索文件
- 批量获取所有页面

**交互式菜单**：
```
请选择操作:
  1. 获取文件列表
  2. 搜索文件
  3. 获取所有页面文件列表
  0. 退出
```

### 2️⃣ 上传文件

**功能**：智能上传文件到云盘，自动选择最优方式

```bash
cd 上传文件

# 交互式上传
python upload_to_123pan_v2.py

# 命令行指定文件
python upload_to_123pan_v2.py /path/to/your/file.zip
```

**特性**：
- ≤ 1GB：单步上传
- \> 1GB：分片上传，自动检测秒传
- 支持任意文件类型
- 最大支持10GB文件

### 3️⃣ 下载文件

**功能**：从云盘下载文件到本地，支持MD5校验

```bash
cd 下载文件

# 命令行模式（推荐）
python 下载文件.py --file-id 12345678 --save-path ./downloads

# 交互式模式
python 下载文件.py
```

**命令行参数**：
- `--file-id` / `-f`：文件ID（必填）
- `--save-path` / `-p`：保存文件夹路径（选填）
- `--token` / `-t`：访问令牌（选填，替代配置文件）
- `--client-id`：客户端ID（选填）
- `--client-secret`：客户端密钥（选填）

### 4️⃣ 离线下载

**功能**：创建离线下载任务，让云盘帮你下载文件

```bash
cd 离线下载
python simple_offline_download.py
```

**使用场景**：
- 手动输入URL
- 从文件批量导入URL

**URL文件格式** (`urls.txt`)：
```
# 下载链接列表，每行一个URL
https://example.com/file1.zip
https://example.com/file2.tar.gz

# 注释行以#开头，会被忽略
# 空行也会被忽略
https://example.com/file3.iso
```

### 5️⃣ 直链管理

**功能**：管理文件直链、监控流量、配置IP黑名单

```bash
cd 直链
python direct_link.py
```

**主要功能**：
1. 获取文件直链
2. 启用/禁用直链空间
3. 刷新直链缓存
4. 获取直链流量日志（需要开发者权益）
5. 获取直链离线日志（需要开发者权益）
6. IP黑名单管理（需要开发者权益）

**使用示例**：
```
请选择操作:
1. 获取文件直链
2. 启用直链空间
3. 禁用直链空间
...
```

### 6️⃣ 图床服务

**功能**：图片CDN加速、管理和分发

```bash
cd 图床
python image_hosting.py
```

**支持的图片格式**：
- PNG、JPEG/JPG、GIF
- TIFF/TIF、WEBP、SVG、BMP
- 最大文件大小：100MB

**主要功能**：
1. 查看图片列表和详情
2. 删除/移动图片
3. 创建图床目录
4. 上传图片（支持秒传和分片上传）
5. 从云盘复制图片到图床
6. 图片离线迁移

**典型使用流程**：
```bash
# 1. 创建图床目录
选择操作: 5 -> 输入目录名 -> 获得目录ID

# 2. 上传图片
选择操作: 6 -> 输入图片路径 -> 输入目录ID

# 3. 查看上传的图片
选择操作: 1 -> 输入目录ID -> 获得CDN链接
```

### 7️⃣ Markdown转换

**功能**：Markdown文件与123网盘互转，包含两个独立工具

```bash
cd "Markdown的互相转换"
```

**工具1：本地Markdown转123云盘在线** (`本地Markdown转123云盘在线.py`)
- 将本地图片上传到123网盘图床
- 将本地附件上传到123网盘直链目录
- 自动替换Markdown文件中的链接

**工具2：在线Markdown转本地** (`在线Markdown转本地.py`)
- 下载Markdown中的外部资源到本地
- 图片保存到 `images` 文件夹
- 附件保存到 `attachments` 文件夹
- 自动替换为本地引用

**使用示例**：
```bash
# 工具1：本地转在线（需要config.txt配置）
python "本地Markdown转123云盘在线.py" document.md

# 工具2：在线转本地（需要安装requests库）
python "在线Markdown转本地.py" -i README.md -o README_local.md
```

**典型场景**：
- 📝 发布前：将本地Markdown转为在线版本，获得CDN加速
- 💾 归档时：将在线Markdown转为本地版本，永久保存
- 🔄 平台迁移：在不同Markdown平台间迁移文档
- 👥 协作编辑：统一团队的资源管理方式

**详细文档**：参见 `Markdown的互相转换/README.md`

## 📦 依赖库

所有工具仅依赖一个外部库：

```bash
pip install requests
```

**系统要求**：
- Python 3.6+
- 支持 Windows、Linux、macOS

## 💡 常见问题

### Q1: 如何找到文件ID？

**方法1**：使用查询工具
```bash
cd 查询文件
python 查询文件.py
# 选择"获取文件列表"即可看到所有文件的ID
```

**方法2**：从网页端获取
- 登录123云盘网页版
- 选中文件右键查看属性或URL中包含文件ID

### Q2: 配置文件找不到怎么办？

确保 `config.txt` 位于项目根目录，与各功能文件夹在同一层级：
```
程序/
├── config.txt          ← 配置文件在这里
├── 查询文件/
├── 上传文件/
└── ...
```

### Q3: 提示"配置文件不存在"

检查文件名是否正确：
- 正确：`config.txt`
- 错误：`config.txt.txt`（Windows可能隐藏扩展名）

解决方法：
```bash
# Windows - 查看完整文件名
dir config.*

# Linux/macOS - 查看完整文件名
ls -la config.*
```

### Q4: 可以使用多个不同的API凭据吗？

**方法1**：命令行参数（临时使用）
```bash
python 下载文件.py --file-id 123 --client-id xxx --client-secret yyy
```

**方法2**：多个配置文件（切换使用）
```bash
# 创建多个配置文件
config_account1.txt
config_account2.txt

# 使用时重命名
cp config_account1.txt config.txt
```

### Q5: 上传/下载速度慢怎么办？

**可能原因**：
1. 网络带宽限制
2. 服务器限速
3. 文件分片大小不合适

**优化建议**：
- 检查网络连接质量
- 避开高峰时段
- 大文件使用分片上传（>1GB自动启用）

### Q6: 直链和普通下载有什么区别？

| 特性 | 普通下载 | 直链 |
|------|---------|------|
| 访问方式 | 需要API认证 | 直接URL访问 |
| CDN加速 | 否 | 是 |
| 分享便利性 | 低 | 高 |
| 流量统计 | 无 | 有（需开发者权益） |
| 适用场景 | 个人使用 | 对外分享、网站引用 |

### Q7: 图床和普通上传有什么区别？

| 特性 | 普通上传 | 图床 |
|------|---------|------|
| 文件类型 | 任意文件 | 仅图片 |
| CDN加速 | 否 | 是 |
| 直链访问 | 需配置 | 自动提供 |
| 大小限制 | 10GB | 100MB |
| 适用场景 | 文件存储 | 图片展示、博客引用 |

### Q8: 出现"MD5校验失败"怎么办？

**可能原因**：
1. 网络传输错误导致文件损坏
2. 下载过程中断

**解决方法**：
```bash
# 重新下载文件
python 下载文件.py --file-id 123456
```

### Q9: 如何批量上传文件？

创建批量上传脚本：

```bash
#!/bin/bash
# upload_batch.sh

cd 上传文件

for file in /path/to/files/*; do
    echo "正在上传: $file"
    python upload_to_123pan_v2.py "$file"
    sleep 2  # 避免频繁请求
done
```

### Q10: 离线下载失败怎么办？

**常见原因**：
1. URL失效或需要登录
2. 资源服务器限制
3. 文件格式不支持

**检查方法**：
```bash
# 手动测试URL是否可访问
curl -I https://example.com/file.zip
```

## 🛠️ 故障排除

### 错误：获取访问令牌失败

**症状**：`❌ 获取访问令牌时发生错误`

**解决方案**：
1. 检查 `CLIENT_ID` 和 `CLIENT_SECRET` 是否正确
2. 确认开放平台账号状态正常
3. 检查网络连接

### 错误：文件不存在

**症状**：`❌ 文件不存在: xxx`

**解决方案**：
1. 检查文件路径是否正确（支持相对路径和绝对路径）
2. 检查文件名是否包含特殊字符
3. 确认有读取文件的权限

### 错误：上传失败

**症状**：`❌ 创建文件失败` 或 `❌ 分片上传失败`

**解决方案**：
1. 检查网络连接
2. 确认文件大小不超过10GB
3. 检查云盘空间是否充足
4. 尝试重新上传

### 警告：审核驳回

**症状**：`⚠️ 警告: 该文件已被审核驳回`

**说明**：文件包含违规内容，被平台审核系统拒绝

**处理**：
- 检查文件内容是否符合平台规范
- 联系平台客服申诉（如果是误判）

## 📁 项目结构

```
程序/
├── 📄 config.txt                          # 配置文件（敏感信息，不要提交到版本控制）
├── 📄 .gitignore                          # Git忽略文件配置
├── 📄 README.md                           # 项目说明文档
│
├── 📂 查询文件/
│   ├── 🐍 查询文件.py                     # 查询脚本（交互式）
│   └── 📝 获取文件列表（推荐）.md         # API文档
│
├── 📂 上传文件/
│   ├── 🐍 upload_to_123pan_v2.py          # 上传脚本（智能选择上传方式）
│   ├── 📝 API文档.md                      # 完整API文档
│   └── 📂 __pycache__/                    # Python缓存（自动生成）
│
├── 📂 下载文件/
│   ├── 🐍 下载文件.py                     # 下载脚本（支持命令行参数）
│   └── 📝 API文档.md                      # API文档和使用说明
│
├── 📂 离线下载/
│   ├── 🐍 simple_offline_download.py      # 离线下载脚本（支持批量）
│   ├── 📝 创建离线下载任务.md             # API文档
│   └── 📂 __pycache__/                    # Python缓存（自动生成）
│
├── 📂 直链/
│   ├── 🐍 direct_link.py                  # 直链管理工具（完整功能）
│   └── 📝 API文档.md                      # 直链相关API文档
│
├── 📂 图床/
│   ├── 🐍 image_hosting.py                # 图床管理工具（完整功能）
│   └── 📝 API文档.md                      # 图床相关API文档
│
└── 📂 Markdown的互相转换/
    ├── 🐍 本地Markdown转123云盘在线.py    # 本地转在线工具（1332行）
    ├── 🐍 在线Markdown转本地.py           # 在线转本地工具（932行）
    └── 📝 README.md                       # 完整使用文档
```

**文件说明**：
- 🐍 `.py` - Python可执行脚本
- 📝 `.md` - Markdown格式的API文档
- 📂 `__pycache__/` - Python编译缓存（可忽略）

## 📚 API文档说明

每个功能模块都包含详细的API文档，文档包括：

### 文档内容
- ✅ 完整的API端点说明
- ✅ 请求参数表格（Header、Body、QueryString）
- ✅ 返回数据格式和字段说明
- ✅ 多语言代码示例（cURL、Java、JavaScript、Python）
- ✅ 实际请求和响应示例
- ✅ 错误码说明

### 文档位置
- **查询文件**：`查询文件/获取文件列表（推荐）.md`
- **上传文件**：`上传文件/API文档.md`
- **下载文件**：`下载文件/API文档.md`
- **离线下载**：`离线下载/创建离线下载任务.md`
- **直链管理**：`直链/API文档.md`
- **图床服务**：`图床/API文档.md`
- **Markdown转换**：`Markdown的互相转换/README.md`

### 更新日期
所有API文档已于 **2025-10-01** 更新，基于123云盘开放平台官方文档。

## 🔗 相关链接

- 🌐 [123云盘开放平台](https://open.123pan.com/)
- 📖 [官方API文档](https://123yunpan.yuque.com/org-wiki-123yunpan-muaork/cr6ced)
- 🐛 [问题反馈](https://github.com/your-repo/issues)（如果项目开源）

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

**贡献前请注意**：
1. 确保代码中不包含任何敏感信息
2. 遵循现有代码风格
3. 添加必要的注释和文档
4. 测试所有修改的功能

## 📝 更新日志

### v2.1 (2025-10-03)
- ✨ 新增Markdown转换工具集
  - 本地Markdown转123云盘在线工具
  - 在线Markdown转本地工具
- 📚 完善Markdown转换文档
- 🔄 支持图片和附件的互转

### v2.0 (2025-10-01)
- ✨ 完善所有功能模块
- 📚 更新所有API文档
- 🔐 增强安全配置说明
- 🐛 修复已知问题

### v1.0
- 🎉 初始版本发布
- ✨ 实现基础上传下载功能

## ⚖️ 许可证

本项目仅供学习和个人使用。

**使用限制**：
- ✅ 个人学习和研究
- ✅ 个人文件管理
- ❌ 商业用途
- ❌ 非法用途
- ❌ 违反123云盘服务条款的用途

## ⚠️ 免责声明

1. 本工具仅为方便用户使用123云盘开放平台API而开发
2. 使用本工具产生的任何后果由使用者自行承担
3. 请遵守123云盘服务条款和相关法律法规
4. 请勿上传、下载、传播违法违规内容
5. 开发者不对用户使用本工具的行为负责

## 💬 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 📧 提交 Issue（如果项目开源）
- 💬 在项目讨论区留言
- 🌐 访问123云盘开放平台官方论坛

---

**感谢使用123云盘开放平台工具集！** 🎉

如果觉得这个项目对你有帮助，欢迎给个⭐Star支持一下！
